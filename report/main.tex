\documentclass[a4paper,twoside,12pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{enumerate}
\usepackage[shortlabels]{enumitem}
\usepackage{fullpage}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{import}
\usepackage{amsmath}
\usepackage{mathabx}
\usepackage{icomma}
\usepackage{booktabs}
\usepackage{ftcap}
\usepackage{lipsum}
\usepackage{url}
\usepackage[binary-units]{siunitx}
\usepackage{epstopdf}
\usepackage{hyperref}
\usepackage{subcaption}

%\usepackage[sorting=none]{biblatex}

\begin{document}
\onehalfspacing%
\thispagestyle{empty}
\begin{flushleft}
 \underline{Sakari} Matias Kapanen\hfill
 \texttt{sakari.m.kapanen@student.jyu.fi}
\end{flushleft}
\vfill
\begin{center}
\textsc{\LARGE A Monte Carlo method for simulating the neutral density profile in an ECR ion source}
\end{center}
\vfill
% Palautuspvm
Supervisor: Taneli Kalvas\\
\vfill
\begin{abstract}
 \noindent
    Lorem ipsum
\end{abstract}
\clearpage%

\setlength{\parindent}{0pt}
\setlength{\parskip}{12pt}

\setcounter{page}{1}

\section{Introduction}
In electron cyclotron resonance ion sources (ECRIS), it is crucial to keep the neutral density low enough to achieve efficient production of high ion charge states. The removal of neutrals is usually realized using turbo vacuum pumps. There are usually vacuum gauges installed in some spots to monitor the pressure.

The gauges, however, cannot capture local deviations in the neutral density. Therefore, the problem was approached by means of numerical simulation. The goal of this research training project was to produce a Monte Carlo code which could be used for that purpose.

It was assumed that the flow of neutrals is in the molecular flow regime, i.e. there is no direct interaction between the neutrals. The groundwork for the free molecular flow simulation was laid earlier in the author's BSc thesis~\cite{kapanen:bsc}.

There certainly have been similar simulation models developed earlier, typically based on the Particle-in-Cell method. Those simulations feature a dynamic model of the ECR plasma, which leads to great computational complexity.

In this project the idea of a simpler, quasi-stationary plasma model was probed. Such a model has the advantage of lower complexity because one only has mutually non-interacting neutrals as test particles. The independence of the test particles also means that the computation is easily parallelizable and performance gains can be had from running on multiprocessor systems.

The bulk of the work in this project consisted of implementing a suitable plasma model and implementing neutral ``ray tracing'' in a real CAD geometry.

\section{Theoretical background}
In a typical ECR ion source, a plasma is formed by injecting neutral gas particles into a vacuum chamber and coupling RF energy to it at the frequency of several $\si{\giga\hertz}$.

The plasma in an ECR ion source is a typical example of a laboratory plasma, with an electron density of $\sim\SI{e11}{\per\centi\metre}$. Due to the electron cyclotron resonance heating, there is a population of electrons with a high average energy of several $\si{\kilo\electronvolt}$. However, there is another population of electrons with lower energies. Thus, the electron energy distribution isn't strictly Maxwell.~\cite{geller:ecr}

Given that the ion confinement time in the magnetic bottle is long enough to achieve thermalization, the ion energy distribution can also be assumed as Maxwellian with a temperature of a few electronvolts~\cite{geller:ecr}.

\subsection{Plasma processes}
This section lists the collision processes where the plasma and neutrals are involved. The focus is purposely kept on reactions concerning the neutrals. lso, only the ``single'' versions of these processes are covered as these dominate over the multiple counterparts in most cases. The formulae for the respective cross sections or rate coefficients are also listed.

Using the cross section $\sigma$, the rate coefficient is then defined as $\langle \sigma(v_r) v_r \rangle$ where $v_r$ is the speed of the target particle relative to the bombarding particles. Considering a Maxwellian population of bombarding particles whose velocities have a uniform direction distribution, the relative speed can be written as
\begin{equation}
    v_r = \sqrt{v_x^2 + v_y^2 + (v_z - v_t)^2}
\end{equation}
where $v_t$ is the speed of the target particle and $v_{\{x, y, z\}}$ are the velocity components of the bombarding particle. Here the direction of the target particle motion was chosen to be along the $z$ axis. This choice is arbitrary due to the symmetry of the velocity distribution of the projectile particles.

Now the rate coefficient can be calculated as an integral over the projectile particle velocity space:
\begin{equation}
    \langle \sigma v_r \rangle = \int\limits_{-\infty}^\infty \int\limits_{-\infty}^\infty \int\limits_{-\infty}^\infty v_r \sigma(v_r) f(v_x, v_y, v_z)\,\mathrm{d}v_x\,\mathrm{d}v_y\,\mathrm{d}v_z,
\end{equation}
where $f(v_x, v_y, v_z)$ is the velocity distribution of the projectile particles. In the context of this simulation, $f$ is the Maxwellian velocity distribution:
\begin{equation}
    f(v_x, v_y, v_z) = \left(\frac{m}{2\pi kT}\right)^{3/2} \exp \left[ -\frac{m(v_x^2 + v_y^2 + v_z^2)}{2kT} \right]
\end{equation}
where $m$ is the projectile particle mass, $k$ is the Boltzmann constant and $T$ is the temperature of the projectile particle population.

\subsubsection{Electron ionization}
Electron (impact) ionization is a process where an energetic electron positively ionizes an atom or an ion by knocking off an electron bound to a shell:
\[
    X^{+n} + e \rightarrow A^{+(n+1)} + 2e,
\]
where $X$ is the original atom ($n=0$) or ion and $e$ is an electron.

There have been many approximations of the electron ionization cross sections, most famously the Lotz equation~\cite{lotz}. A more convenient approximation was found in~\cite{recommended_ionization} and is given in the form of a fit function
\begin{equation}
    \label{eq:ionization_fit}
    \sigma(E) = \frac{1}{IE} \left[ A \ln \left(\frac{E}{I}\right) + \sum\limits_{i=1}^N
    B_i \left(1-\frac{I}{E}\right)^i \right]
\end{equation}
where $E$ is the electron energy, $I$ is the ionization potential of the atom or ion and $A$, $B_i$ are fit parameters depending on the atom or ion. The fit parameters are given in~\cite{recommended_ionization}. Notice that the cross section is given as a function of the electron energy instead of the relative velocity --- however, because the electron speed is undoubtedly much greater than the target particle speed, this is a perfectly valid approximation.

For example, the fit parameters for argon neutrals are listed in table~\ref{table:argon_ionization}.
\begin{table}
    \centering
    \caption{Fit parameters of equation~\ref{eq:ionization_fit} for argon neutrals~\cite{recommended_ionization}.}
    \label{table:argon_ionization}
    \begin{tabular}{cccccccc}
        \toprule
        $I\,(\si{\electronvolt})$ & $A$ & $B_1$ & $B_2$ & $B_3$ & $B_4$ & $B_5$ & condition\\
        \midrule
        15.8 & 2.532 & -2.672 & 2.543 & -0.769 & 0.008 & 0.006 & \\
        15.8 & 4.337 & 3.092 & -21.253 & 14.626 & 0.018 & 0.031 & $E > 4.13I$ \\
        \bottomrule
    \end{tabular}
\end{table}

In the context of the simulation, the electron ionization reaction converts neutrals to ions.

\subsubsection{Charge exchange}
Charge exchange is a process where an ion $X$ exchanges an electron with another ion or an atom $X$:
\[
    X^{+m} + Y^{+n} \rightarrow X^{+(m-1)} + Y^{+(n+1)}.
\]
For example, $X$ being a $+1$ ion and $Y$ an atom:
\[
    X^{+1} + Y^0 \rightarrow X^{0} + Y^{+1}.
\]

A famous approximation for the single charge exchange cross section is the one proposed by Salzborn et al. and used in~\cite{cex} as
\begin{equation}
    \label{eq:cex}
    \sigma_{q, q-1} = 1.43 \times 10^{-12} q^{1.17} I^{-2.76}\,(\si{\centi\metre\squared}),
\end{equation}
where $q$ is the initial charge of the projectile and $I$ is the ionization potential of the target particle in $\si{\electronvolt}$.

\subsubsection{Recombination}
In recombination, a free electron is bound onto a shell of an ion and the excess energy is released as a photon $\gamma$. If the release of energy happens ``directly'', the process is called radiative recombination:
\[
    X^{+n} + e \rightarrow X^{+(n-1)} + \gamma.
\]
The released energy can also excite another bound electron which then de-excites and emits a photon:
\[
    X^{+n} + e \rightarrow X^{+(n-1)**} \rightarrow X^{+(n-1)} + \gamma.
\]
This process is called dielectronic recombination.~\cite{nist:recombination}

Precalculated rate coefficients for these two processes at various different electron temperatures were found at~\cite{iaea:flychk}. The rate coefficients of the two processes were summed to yield a total recombination rate coefficient.

\subsection{Ion loss}
In addition to recombination, a remarkable neutralization channel is the loss of ions from the magnetic bottle. When an ion is no longer confined by the magnetic bottle, it eventually hits a wall of the vacuum chamber. Inelastic collision reactions with the wall material eventually neutralize the ion and it will be desorbed.

\subsection{Knudsen's cosine law}
The desorption of neutrals from walls of the vacuum chamber is assumed to be governed by Knudsen's cosine law~\cite{knudsen:cosine}:
\begin{equation}
    \mathrm{d}n = \frac{n}{\pi}\cos\theta \,\mathrm{d}\omega,
\end{equation}
where $n$ is the flux of particles desorbing into the solid angle element $\mathrm{d}\omega$.

\subsection{Thermal accommodation}
When a particle is adsorbed onto a wall, it may be only partially thermalized with the wall before desorption. The efficiency of this thermalization process is characterized by the \emph{accommodation coefficient} $\alpha$, which depends on the surface material, surface finish and the element of the incoming particles. It is defined according to the equation
\begin{equation}
    \alpha = \frac{E_\text{in} - E_\text{re}}{E_\text{in} - E_\text{w}},
\end{equation}
where $E_\text{in}$ is the incoming energy flux, $E_\text{re}$ the reflected flux and $E_\text{w}$ the emitted energy flux in the case of full thermalization.~\cite{sandia:accom}

\section{Numerical methods and tools}
Several numerical methods and software packages were used to implement the calculation of the neutral density distribution.

\subsection{Monte Carlo test particle simulation}
The basis of the simulation is the test particle Monte Carlo method. A limited set of test particles is chosen to represent the real particles and given a corresponding statistical weight in the simulation. Their phase space coordinates are randomly drawn from the corresponding probability distributions and propagated through the target geometry. On wall collisions, a new direction and velocity are calculated according to Knudsen's cosine law and the thermal accommodation law. The test particle simulation of neutrals without plasma is covered in detail in~\cite{kapanen:bsc}.

\subsection{A simple quasi-stationary plasma model}
THe plasma model implemented in this simulation describes the plasma electrons and ions of different charge states as density distributions defined in a cubic grid. The velocities of the plasma particles are approximated as Maxwellian with predefined temperatures.

Taking the conservation of the plasma mass as a guiding principle, the following approximations were made:
\begin{itemize}
    \item Stationarity: the plasma population parameters (density, temperature) are not affected by collision reactions.
    \item The spatial density distributions of the ion populations are proportional to the distribution of electrons. The code takes the global charge state distribution as a parameters.
    \item The plasma consists of only one element.
    \item Elastic collisions between the neutrals and the plasma particles are neglected.
\end{itemize}

An ionizing collision reaction may result in excess mass accumulating in the plasma. Conservetion of mass is implemented here: the plasma must eventually emit a particle through some channel.

In this simulation, the two collision processes involving neutrals are charge exchange and electron ionization. In charge exchange, the plasma mass offset is unchanged because an ion is neutralized but the plasma also receives a new ion. Thus there is no need to emit an additional neutral. In electron ionization, a neutral comes in and is ionized by an electron, thus the plasma gains an excess of one particle. The excess is compensated by statistically choosing a neutralization channel and the corresponding neutralization time.

\subsubsection{Monte Carlo collisions}
To handle collisions processes of neutrals with the plasma particles (ions and electrons), a Monte Carlo collision method has to be used. The electrons and ions don't exist in the simulation as individual test particles but as particle distributions.

Consider a test particle traveling through a particle population bombarding it at the frequency $\nu$. Remembering that a single test particle represents multiple real particles, the propagation of the test particle can be seen as probability flux or an ``intensity''. The calculation of collision probabilities arises from the differential equation
\begin{equation}
    \frac{\mathrm{d}p}{\mathrm{d}t} = -\nu p(t),
\end{equation}
where $p$ is the particle probability flux and $t$ the time. Setting $p(0) = 1$, The solution to this differential equation is
\[
    p(t) = \exp(-\nu t).
\]
The collision probability is now found as the complement:
\begin{equation}
    p_\text{coll} = 1 - \exp(-\nu t),
\end{equation}
where $\nu$ is the rate of the collision reaction in question. Considering a test particle propagating by a timestep $\Delta t$ in a projectile particle cloud of density $n_i$ and the rate coefficient of the reaction is $\langle v_r \sigma_i \rangle$, the probability of the collision happening during the timestep is
\begin{equation}
    p_i = 1 - \exp(-n_i \langle v_{r, i} \sigma_i \rangle \Delta t),
\end{equation}
where $v_{r, i}$ is the relative speed of the test particle to the projectile population. Drawing a pseudo-random number $x \in [0, 1[$, a collision now happens if
\[
    x \leq p_i = 1 - \exp(-n_i \langle v_{r, i} \sigma_i \rangle \Delta t),
\]
or equivalently
\[
    x > - \exp(-n_i \langle v_{r, i} \sigma_i \rangle \Delta t).
\]

When there are multiple populations and collision reactions, the total collision frequency is calculated as:
\begin{equation}
    \nu_\text{tot} (v) = \sum\limits_i \nu_i = \sum\limits_i n_i \langle v_{r, i} \sigma_i \rangle,
\end{equation}
where $i$ runs over different collision reactions.
In practice, the values $\langle v_{r, i} \sigma_i \rangle$ are expensive to calculate and are thus precomputed in a grid of some fixed values of $v$ and stored in an array. Linear interpolation between the gridpoints is used to acquire the collision frequency at arbitrary values of $v$.

The total collision frequency is used at each timestep to decide if a collision has happened. In the case of a collision, the collision reaction type $i$ is randomly decided using the individual reaction rates as the probability distribution:
\begin{equation}
    p[i] = \frac{\nu_i}{\nu_\text{tot}}.
\end{equation}
Given a pseudo-random number $x \in [0, 1[$, the chosen reaction is the smallest value of $i$ such that
\[
    x \leq \frac{\sum\limits_{j=0}^i \nu_j}{\nu_\text{tot}}.
\]

When the decision on the collision process is made, a projectile particle is sampled from the corresponding particle population. The collision dynamics are then calculated in the center-of-mass frame. The neutral product (if any) is then tracked further.

The reactions handled in the way described above in the simulation are charge exchange and electron ionization.

\subsubsection{Neutralization channel sampling}

\subsection{Single electron simulation}

\subsection{Calculating the confinement time}

\subsection{Software design}

\section{Results}

\subsection{Convergence test}

\subsection{Stationary density distribution}

\subsection{Time dependent density distribution}

\section{Conclusions}

\clearpage

\bibliographystyle{unsrt}
\bibliography{references}

\end{document}

